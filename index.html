<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <title>Editor Zero</title>
</head>
<body style="background-color: #232323;">
    <windowControls>
        <windowCloseButton>
            <img src="close.png" alt="Close">
        </windowCloseButton>
        <windowMinimizeButton>
            <img src="minimize.png" alt="Minimize">
        </windowMinimizeButton>
    </windowControls>
    <content>
        <editor contenteditable></editor>
        <lineNumbers></lineNumbers>
    </content>
    <script src="tabs.js"></script>
    <script>
        // Check if this is a browser, or Electron
        try {
            require("electron")
        } catch (e) {
            location.href = "no-browser.html"
        }

        // Get window
        const win = require("electron").remote.getCurrentWindow()

        // Set up window controls
        const windowControls = document.querySelector("windowcontrols")
        const windowCloseButton = document.querySelector("windowclosebutton")
        const windowMinimizeButton = document.querySelector("windowminimizebutton")
        windowCloseButton.onclick = (() => win.close())
        windowMinimizeButton.onclick = (() => win.minimize())

        // Set key press events
        window.onkeydown = keyDown
        window.onkeyup = keyUp
        window.onkeypress = keyPress

        // Show window
        win.show()

        // Handle keyDown events
        function keyDown(e) {
            if (document.activeElement === editor) {
                numberLines()
                if (e.key === "Tab") {
                    if (e.shiftKey) {
                        window.getSelection().getRangeAt(0).setEnd(window.getSelection().getRangeAt(0).startContainer, window.getSelection().getRangeAt(0).startOffset)
                        window.getSelection().getRangeAt(0).setStart(window.getSelection().getRangeAt(0).startContainer, window.getSelection().getRangeAt(0).startOffset - 1)
                        window.getSelection().getRangeAt(0).deleteContents()
                        e.preventDefault()
                    } else {
                        window.getSelection().getRangeAt(0).insertNode(document.createTextNode("\xa0\xa0\xa0\xa0"))
                        window.getSelection().getRangeAt(0).setStart(window.getSelection().getRangeAt(0).endContainer, window.getSelection().getRangeAt(0).endOffset)
                        e.preventDefault()
                    }
                }
            }
            if (e.key === "w" && e.ctrlKey) {
                if (Tabs.amount() === 1) {
                    win.close()
                } else {
                    Tabs.currentTab().close()
                }
                e.preventDefault()
            }
        }
        function keyUp(e) {

        }
        function keyPress(e) {

        }

        // Get editor tag
        const editor = document.querySelector("editor")

        // Initialize tabs
        const Tabs = new tabs(editor, windowControls)
        Tabs.add("welcome.txt", "Welcome<br>Welcome<br>Welcome<br>Welcome<br>Welcome<br>Welcome<br>Welcome<br>Welcome", true)
        Tabs.add("JoeMama.html", "Joe Mama", true)

        // Set up line numbers
        numberLines()
        function numberLines() {
            const lineNumbers = document.querySelector("linenumbers")
            lineNumbers.innerHTML = ""
            const lines = editor.innerHTML.split("<br>").length
            for (let i = 0; i < lines; i++) {
                const lineNumber = document.createElement("lineNumber")
                lineNumber.innerHTML = (i + 1) + "<br>"
                lineNumbers.appendChild(lineNumber)
            }
        }
    </script>
</body>
</html>